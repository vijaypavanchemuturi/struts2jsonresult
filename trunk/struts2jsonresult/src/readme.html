<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>无标题文档</title>
</head>
<body>
This struts2 plugin simply provide a new result type: 'json'， as an alternative to <a href="http://cwiki.apache.org/S2PLUGINS/json-plugin.html">struts2 json plugin</a>
.
</p>
<h2>Dependencies</h2>
Put the following jars together with your struts jar files.
<ul>
  <li>common logging 1.04 or above, the logger name is the same as the class
    name
  <li><a href=
  'http://sourceforge.net/project/showfiles.php?group_id=194042'>flexjson 1.7
    or above</a>
</ul>
<h2>Installation</h2>
<p> put the dependencies and the jsonresulttype.jar to your WEB-INF/lib directory.</p>
<h2>Configuration Example </h2>
<p>In struts2.xml, define a package that extends struts-default and set the result type json as default. </p>
<pre>
	&lt;package name=&quot;json&quot; extends=&quot;struts-default&quot;&gt;<br />		&lt;result-types&gt;<br />			&lt;result-type name=&quot;json&quot; default=&quot;true&quot;<br />				class=&quot;code.google.struts2jsonresult.JSONResult&quot;&gt;
				&lt;!-- serialize the json string in well read format --&gt;<br />				&lt;param name=&quot;prettyPrint&quot;&gt;true&lt;/param&gt;<br />			&lt;/result-type&gt;<br />		&lt;/result-types&gt;<br />	&lt;/package&gt;


Define your action in your struts2.xml
	&lt;package name=&quot;article&quot; extends=&quot;json&quot; namespace=&quot;/article&quot;&gt;<br />		&lt;action name=&quot;showPostForm&quot; class=&quot;articleAction&quot; method=&quot;showPostForm&quot;&gt;<br />			&lt;result&gt;
				&lt;!-- ignore the class property of the bean that to be serialized --&gt;<br />				&lt;param name=&quot;patterns&quot;&gt; -*.class &lt;/param&gt;
				&lt;!-- the bean to be serialized, by default, it's the action itself. now  action.getResult will be serialized. --&gt;
                                &lt;param name=&quot;target&quot;&gt;result&lt;/param&gt;<br />			&lt;/result&gt;<br />		&lt;/action&gt;<br />	&lt;/package&gt;

Action code:

<br />
public class ArticleAction {
	private Object result;

	public String listByStudent() {

		this.result=........;
		return Action.SUCCESS;
	}

	
	public Object getResult() {
		return result;
	}
}

  </pre>
<table border="1">
  <tr>
    <th width="135" scope="col">parameter name </th>
    <th width="110" scope="col">default value </th>
    <th width="708" scope="col">description</th>
  </tr>
  <tr>
    <td>target</td>
    <td>null</td>
    <td><p>the bean to be serialized, if set to null, the action itself will be serialized. </p>
    </td>
  </tr>
  <tr>
    <td>patterns</td>
    <td>null</td>
    <td><p>Fully support the patterns that can be applied to flexjson. Use '+' as include, and '-' as exclude. For example</p>
    <pre>&lt;action name=&quot;listByStudent&quot; class=&quot;articleAction&quot; method=&quot;listByStudent&quot;&gt;<br />			&lt;result&gt;<br />				&lt;param name=&quot;patterns&quot;&gt; -*.class, -gradeArticle &lt;/param&gt;<br />			&lt;/result&gt;<br />&lt;/action&gt;
</pre>
    <p>this will be translated to new JSONSerializer().exclude(&quot;*.class&quot;).exclude(&quot;gradeArticle&quot;)</p>
    <p>About how to use patterns in flexjson, refer to <a href="http://flexjson.sourceforge.net/">http://flexjson.sourceforge.net/</a>  
    and the javadoc of JSONSerializer</p>
    <p><a href="http://flexjson.sourceforge.net/javadoc/flexjson/JSONSerializer.html">http://flexjson.sourceforge.net/javadoc/flexjson/JSONSerializer.html</a>
    </p></td>
  </tr>
  <tr>
    <td>prettyPrint</td>
    <td>false</td>
    <td>whether to format the result json string </td>
  </tr>
  <tr>
    <td>rootName</td>
    <td>null</td>
    <td> <p>if set, it will wrap   the resulting JSON in a javascript object that contains a single field   named rootName.</p>
    </td>
  </tr>
  <tr>
    <td>deepSerialize</td>
    <td>false</td>
    <td>whether to deep serialize the object, by default flexjson will not serialize the collections in a bean </td>
  </tr>
  <tr>
    <td>out.contentType</td>
    <td>application/json</td>
    <td>http reponse content type </td>
  </tr>
  <tr>
    <td>out.statusCode</td>
    <td>200</td>
    <td>http status code of the response, sometimes 500 maybe used to indicate an exception </td>
  </tr>
  <tr>
    <td>out.characterEncoding</td>
    <td>utf-8</td>
    <td>http response character encoding </td>
  </tr>
  <tr>
    <td>out.gzip</td>
    <td>false</td>
    <td>whether to use gzip to compress the response, to reduce the network transfer load </td>
  </tr>
  <tr>
    <td>out.noCache</td>
    <td>false</td>
    <td><p>when set to true, the following 3 headers will be set.</p>
      <p>Cache-Control set to no-cache</p>
      <p>Expires set to 0</p>
      <p>Pragma set to No-cache   </p>
      <p>&nbsp;</p>
    <p>&nbsp;</p></td>
  </tr>
  <tr>
    <td>&nbsp;</td>
    <td>&nbsp;</td>
    <td>&nbsp;</td>
  </tr>
</table>
<pre>&nbsp;
  </pre>
<h2>Exception handling </h2>
<p>You can define some global exception mapping in your struts.xml. when exception is thrown, an special status code can be used, and the client can deal with different exception type by the status code.</p>
<p>For example:</p>
<pre>	&lt;package name=&quot;json&quot; extends=&quot;struts-default&quot;&gt;<br />		&lt;result-types&gt;<br />			&lt;result-type name=&quot;json&quot; default=&quot;true&quot;<br />				class=&quot;code.google.struts2jsonresult.JSONResult&quot;&gt;<br />				&lt;param name=&quot;target&quot;&gt;result&lt;/param&gt;<br />				&lt;param name=&quot;out.gzip&quot;&gt;true&lt;/param&gt;<br />				&lt;param name=&quot;prettyPrint&quot;&gt;true&lt;/param&gt;<br />			&lt;/result-type&gt;<br />		&lt;/result-types&gt;<br />		<br />		&lt;global-results&gt;<br />			&lt;result name=&quot;RuntimeException&quot; type=&quot;json&quot;&gt;<br />				&lt;param name=&quot;out.statusCode&quot;&gt;500&lt;/param&gt;<br />				&lt;param name=&quot;target&quot;&gt;exception&lt;/param&gt;<br />				&lt;param name=&quot;patterns&quot;&gt;+class,+message,-*&lt;/param&gt;<br />			&lt;/result&gt;<br />			<br />			&lt;result name=&quot;ApplicationException&quot; type=&quot;json&quot;&gt;<br />				&lt;param name=&quot;out.statusCode&quot;&gt;501&lt;/param&gt;<br />				&lt;param name=&quot;target&quot;&gt;exception&lt;/param&gt;<br />				&lt;param name=&quot;patterns&quot;&gt;+class,+message,-*&lt;/param&gt;<br />			&lt;/result&gt;			<br />		&lt;/global-results&gt;<br />		&lt;global-exception-mappings&gt;<br />			&lt;exception-mapping exception=&quot;com.tdyc.spider.ApplicationException&quot;<br />				result=&quot;ApplicationException&quot; /&gt;<br />			&lt;exception-mapping exception=&quot;java.lang.RuntimeException&quot;<br />				result=&quot;RuntimeException&quot; /&gt;<br />		&lt;/global-exception-mappings&gt;<br />	&lt;/package&gt;</pre>
<p>Now when an exception occurs, for example a NullPointerException, following json will be the output with a status code 500:</p>
<pre>	{    
	  &quot;class&quot;: &quot;java.lang.NullPointerException&quot;,
   &quot;message&quot;: null  
 }</pre>
<p>Notice the patterns for flexjson:</p>
<p><strong>The first expression to match a path that action will be taken thus short circuiting all other   expressions defined later. </strong></p>
<p>so for &quot;+class,+message,-*&quot;, only the class and message properties are included.</p>
<p>&nbsp;</p>
<h2>Credit </h2>
<p>
  <a href="http://sourceforge.net/users/charliehubbard/">charliehubbard</a> 
for his flexjson</p>
<p>deveoplers of <a href="http://code.google.com/p/jsonplugin/">struts2 json plugin</a>
: the ResponseWrapper class borrows a lot from their code.</p>
<h2>Contact </h2>
<p>LRGCC (a) YAHOO(dot)COM(dot)CN</p>
<p>I'm now a senior technical consult in a startup company. My major fields are Java/J2EE software development, training, and technical advocating. </p>
<p>&nbsp;</p>
</body>
</html>
